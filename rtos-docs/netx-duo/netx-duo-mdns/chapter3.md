---
title: 'Capítulo 3: Descripción de la caché de servicio interna'
description: 'El módulo mDNS de NetX Duo administra dos cachés de servicio internas: la caché de servicio local y la caché de servicio del mismo nivel.'
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 007f1080a076730cfbcdedc9f063ac0c427a414c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814662"
---
# <a name="chapter-3---description-of-internal-service-cache"></a><span data-ttu-id="2292d-103">Capítulo 3: Descripción de la caché de servicio interna</span><span class="sxs-lookup"><span data-stu-id="2292d-103">Chapter 3 - Description of internal service cache</span></span>

<span data-ttu-id="2292d-104">El módulo mDNS de NetX Duo administra dos cachés de servicio internas: la caché de servicio local y la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-104">NetX Duo mDNS module manages two internal services caches: the local service cache, and the peer service cache.</span></span> <span data-ttu-id="2292d-105">La caché del servicio local almacena los registros de recursos relacionados con los servicios que ofrecen las aplicaciones que se ejecutan en el nodo.</span><span class="sxs-lookup"><span data-stu-id="2292d-105">The local service cache stores Resource Records related to services offered by applications running on the node.</span></span> <span data-ttu-id="2292d-106">En el caso de las consultas entrantes, si la pregunta coincide con el servicio ofrecido, mDNS responde con las respuestas almacenadas en la caché del servicio local.</span><span class="sxs-lookup"><span data-stu-id="2292d-106">For incoming queries, if the question matches the service offered, mDNS responses with answers stored in the local service cache.</span></span> <span data-ttu-id="2292d-107">Las aplicaciones registran servicios mediante la llamada a la API *nx_mdns_service_add()* .</span><span class="sxs-lookup"><span data-stu-id="2292d-107">Applications register services by calling the API *nx_mdns_service_add()*.</span></span> <span data-ttu-id="2292d-108">Para quitar servicios y aplicaciones, use la API *nx_mdns_service_delete()* , que, a su vez, enviará mensajes de despedida antes de quitar las entradas correspondientes de la caché del servicio local.</span><span class="sxs-lookup"><span data-stu-id="2292d-108">To remove services, applications use the API *nx_mdns_service_delete()*, which will in turn send "goodbye" messages before removing the corresponding entries in the local service cache.</span></span>

<span data-ttu-id="2292d-109">Cuando se agrega un servicio, mDNS mantiene al menos 3 registros de recursos en la caché del servicio local: SRV, PTR y TXT.</span><span class="sxs-lookup"><span data-stu-id="2292d-109">When a service is added, mDNS maintains at least 3 Resource Records in the local service cache: SRV, PTR, and TXT.</span></span> <span data-ttu-id="2292d-110">Se puede agregar un registro de recursos PTR adicional si el tipo de servicio incluye el subtipo.</span><span class="sxs-lookup"><span data-stu-id="2292d-110">Additional PTR Resource Record may be added if the service type includes subtype.</span></span> <span data-ttu-id="2292d-111">Por ejemplo, una aplicación registra un servicio:</span><span class="sxs-lookup"><span data-stu-id="2292d-111">For example, an application registers a service:</span></span>

```
*name*._*subtype*._sub._*type*._tcp.local,
```

<span data-ttu-id="2292d-112">dos registros de recursos PTR se agregan a la caché de servicio local, uno para</span><span class="sxs-lookup"><span data-stu-id="2292d-112">two PTR Resource Records are added to the local service cache, one for</span></span>

```
“*_subtype._*sub*._type._*tcp.local *PTR name.type._*tcp*.*local”
```

<span data-ttu-id="2292d-113">y el otro para</span><span class="sxs-lookup"><span data-stu-id="2292d-113">and the other one for</span></span>

```
*“_type._*tcp*.*local *PTR name.type._*tcp*.*local”.
```

<span data-ttu-id="2292d-114">La caché de servicio del mismo nivel contiene registros de recursos mDNS recibidos de los nodos vecinos.</span><span class="sxs-lookup"><span data-stu-id="2292d-114">The peer service cache contains mDNS Resource Records received from neighboring nodes.</span></span> <span data-ttu-id="2292d-115">El módulo mDNS recopila registros de recursos anunciados por otros nodos de la red y almacena la información recibida en la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-115">mDNS module collects Resource Records advertised by other nodes on the network, and stores the received information in the peer service cache.</span></span> <span data-ttu-id="2292d-116">Cuando la aplicación consulta información, como direcciones IPv4 o IPv6 del host, mDNS busca en la caché de servicio del mismo nivel las respuestas almacenadas en caché localmente.</span><span class="sxs-lookup"><span data-stu-id="2292d-116">When application queries for information such as host IPv4 or IPv6 addresses, mDNS searches the peer service cache for locally cached responses.</span></span> <span data-ttu-id="2292d-117">Cuando la aplicación consulta los servicios ofrecidos por los nodos del mismo nivel, mDNS busca en la caché los registros de direcciones PTR, SRV, TXT y IPv4/IPv6 relacionados.</span><span class="sxs-lookup"><span data-stu-id="2292d-117">When application queries for services offered by peers, mDNS searches through the cache for related PTR, SRV, TXT, and IPv4/IPv6 address records.</span></span> <span data-ttu-id="2292d-118">La caché de servicio del mismo nivel también almacena las consultas enviadas al nodo.</span><span class="sxs-lookup"><span data-stu-id="2292d-118">The peer service cache also stores queries sent to the node.</span></span> <span data-ttu-id="2292d-119">Por ejemplo, una aplicación puede solicitar un servicio determinado mediante la llamada a *nx_mdns_service_one_shot_query.*</span><span class="sxs-lookup"><span data-stu-id="2292d-119">For example, an application may request a particular service by calling *nx_mdns_service_one_shot_query.*</span></span> <span data-ttu-id="2292d-120">Si el servicio no se encuentra en la caché de servicio del mismo nivel, mDNS crea preguntas de consulta (PTR, SRV y TXT) en dicha caché.</span><span class="sxs-lookup"><span data-stu-id="2292d-120">If the service is not found in the peer service cache, mDNS creates query questions (PTR, SRV, and TXT) in the peer service cache.</span></span> <span data-ttu-id="2292d-121">Estas preguntas de consulta se enviarán a la red de forma periódica hasta que se resuelva el servicio o se agote el tiempo de espera. De igual forma, la aplicación puede usar la API *nx_mdns_service_continous_query()* para solicitar un servicio determinado durante un largo período de tiempo (la aplicación cancela una consulta continua emitida anteriormente mediante la API *nx_mdns_service_query_stop de API()* ).</span><span class="sxs-lookup"><span data-stu-id="2292d-121">These query questions will be sent to the network periodically till the service is resolved, or times out. Similar, the application may use the API *nx_mdns_service_continous_query()* to request a particular service over a long period of time (application cancels a previously issued continuous query by using the API *nx_mdns_service_query_stop()* ).</span></span> <span data-ttu-id="2292d-122">Para buscar un servicio determinado en la caché de servicio del mismo nivel sin enviar consultas a la red, las aplicaciones pueden utilizar la API *nx_mdns_serivce_lookup().*</span><span class="sxs-lookup"><span data-stu-id="2292d-122">To search for a particular service in the peer service cache without sending queries to the network, applications can use the API *nx_mdns_serivce_lookup().*</span></span> <span data-ttu-id="2292d-123">Esta API solo busca los registros de recursos en la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-123">This API only searches the resource records in the peer service cache.</span></span>

<span data-ttu-id="2292d-124">Cada registro de recursos se almacena en una estructura de datos *NX_MDNS_RR* en las cachés de servicio.</span><span class="sxs-lookup"><span data-stu-id="2292d-124">Each Resource Record is stored in a data structure *NX_MDNS_RR* in the service caches.</span></span> <span data-ttu-id="2292d-125">Las cadenas de los registros de recursos son de longitud variable, por lo que no se almacenan en la estructura *NX_MDNS_RR*.</span><span class="sxs-lookup"><span data-stu-id="2292d-125">Strings in Resource Records are variable length, therefore are not stored in the *NX_MDNS_RR* structure.</span></span> <span data-ttu-id="2292d-126">El registro de recursos contiene un puntero a la ubicación de memoria real donde se almacena la cadena.</span><span class="sxs-lookup"><span data-stu-id="2292d-126">The Resource Record contains a pointer to the actual memory location where the string is stored.</span></span> <span data-ttu-id="2292d-127">La tabla de cadenas y los registros de recursos comparten la caché de servicio.</span><span class="sxs-lookup"><span data-stu-id="2292d-127">The string table and the Resource Records share the service cache.</span></span> <span data-ttu-id="2292d-128">Los registros de recursos se almacenan desde el principio de la caché de servicio y crecen hasta que se llena la caché.</span><span class="sxs-lookup"><span data-stu-id="2292d-128">Resource Records are stored from the beginning of the service cache, and grow towards the end of the cache.</span></span> <span data-ttu-id="2292d-129">La tabla de cadenas comienza desde el final de la caché de servicio y crece hasta el principio de la caché.</span><span class="sxs-lookup"><span data-stu-id="2292d-129">The string table starts from the end of the service cache and grows towards the beginning of the cache.</span></span> <span data-ttu-id="2292d-130">Cada cadena de la tabla de cadenas tiene un campo de longitud y un campo de contador.</span><span class="sxs-lookup"><span data-stu-id="2292d-130">Each string in the string table has a length field and a counter field.</span></span> <span data-ttu-id="2292d-131">Cuando se agrega una cadena a la tabla de cadenas, si la misma cadena ya está presente en la tabla, el valor del contador se incrementa y no se asigna memoria a la cadena.</span><span class="sxs-lookup"><span data-stu-id="2292d-131">When a string is added to the string table, if the same string is already present in the table, the counter value is incremented and no memory is allocated for the string.</span></span> <span data-ttu-id="2292d-132">La caché de servicio se considera llena si no se pueden agregar más registros de recursos ni cadenas nuevas a la caché de servicio.</span><span class="sxs-lookup"><span data-stu-id="2292d-132">The service cache is considered full if no more resource records or new strings can be added to the service cache.</span></span>

<span data-ttu-id="2292d-133">Hay dos maneras de que una aplicación encuentre los servicios ofrecidos en la red local.</span><span class="sxs-lookup"><span data-stu-id="2292d-133">There are two ways for an application to find services offered on the local network.</span></span> <span data-ttu-id="2292d-134">Se puede emitir una búsqueda de un servicio específico mediante una consulta de una sola vez, o bien se puede iniciar una consulta continua para "supervisar" las actividades de la red.</span><span class="sxs-lookup"><span data-stu-id="2292d-134">It can either issue a specific service look up through a one-shot query, or it can initiate a continuous query to “monitor” the activities on the network.</span></span> <span data-ttu-id="2292d-135">En el escenario de consulta única, la aplicación debe especificar el tipo de servicio.</span><span class="sxs-lookup"><span data-stu-id="2292d-135">In the one-short query scenario, the application must specify the service type.</span></span> <span data-ttu-id="2292d-136">mDNS busca en la caché de servicio local y en la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-136">mDNS searches through the local service cache and the peer service cache.</span></span> <span data-ttu-id="2292d-137">Si se encuentra una instancia de servicio, la consulta única devuelve la información encontrada en los registros de recursos.</span><span class="sxs-lookup"><span data-stu-id="2292d-137">If a service instances is located, the one-shot query returns with the information found in the Resource Records.</span></span> <span data-ttu-id="2292d-138">Si no hay ningún registro en la caché de servicio local ni en la caché de servicio del mismo nivel, mDNS envía mensajes de consulta.</span><span class="sxs-lookup"><span data-stu-id="2292d-138">If there are no records in the local service cache or peer service cache, mDNS sends out query messages.</span></span> <span data-ttu-id="2292d-139">Si se especifica el nombre de la instancia, se envía a la red local un tipo *ANY* (consultar el tipo SRV y TXT) con el nombre de instancia específico, con el formato "name.type.local".</span><span class="sxs-lookup"><span data-stu-id="2292d-139">If the instance name is specified, an *ANY* type (query the SRV and TXT type) with the specific instance name, in the form of “name.type.local”, is sent to the local network.</span></span> <span data-ttu-id="2292d-140">Si no se especifica el nombre de instancia, se envía un tipo PTR de consulta a la red local.</span><span class="sxs-lookup"><span data-stu-id="2292d-140">If the instance name is not specified, a PTR type of query is sent to the local network.</span></span> <span data-ttu-id="2292d-141">El primer servicio completo recibido se devuelve al autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="2292d-141">The first complete service received is returned to the caller.</span></span>

<span data-ttu-id="2292d-142">La consulta continua funciona de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="2292d-142">Continuous query works differently.</span></span> <span data-ttu-id="2292d-143">El caso de uso típico de una consulta continua es supervisar la red local en busca de un servicio específico (por ejemplo, para buscar constantemente servicios de impresión en la red local).</span><span class="sxs-lookup"><span data-stu-id="2292d-143">The typical use case for a continuous query is to monitor the local network for a specific service (for example to constantly look for printing services on the local network).</span></span> <span data-ttu-id="2292d-144">En este caso, la aplicación emite una consulta de búsqueda (a través de la API *nx_mdns_service_continious_* query) de ciertos tipos de servicios.</span><span class="sxs-lookup"><span data-stu-id="2292d-144">In this case the application issues a search query (via the API *nx_mdns_service_continious_* query) for certain type of services.</span></span> <span data-ttu-id="2292d-145">Normalmente, el autor de llamada no espera una respuesta determinada.</span><span class="sxs-lookup"><span data-stu-id="2292d-145">The caller typically does not wait for a particular response.</span></span> <span data-ttu-id="2292d-146">En el caso de las consultas enviadas como consultas continuas, el módulo mDNS transmite las consultas periódicamente con intervalos que aumentan exponencialmente.</span><span class="sxs-lookup"><span data-stu-id="2292d-146">For queries submitted as continuous query, the mDNS module transmits the queries periodically with exponentially increasing intervals.</span></span> <span data-ttu-id="2292d-147">Para detener la consulta, la aplicación debe usar la API *nx_mdns_service_query_stop* para detener el temporizador interno de estas consultas.</span><span class="sxs-lookup"><span data-stu-id="2292d-147">To stop the query, application must use the API *nx_mdns_service_query_stop* to stop the internal timer in these queries.</span></span> <span data-ttu-id="2292d-148">El tipo de consulta puede ser NULL, en cuyo caso el tipo de consulta se establece en el tipo PTR especial "_services._dns-sd._udp.local".</span><span class="sxs-lookup"><span data-stu-id="2292d-148">The query type can be NULL, in which case the query type is set to special PTR type “_services._dns-sd._udp.local”.</span></span> <span data-ttu-id="2292d-149">Este tipo de servicio se define mediante mDNS como una manera de detectar todos los servicios disponibles en la red local.</span><span class="sxs-lookup"><span data-stu-id="2292d-149">This service type is defined by mDNS as a way to discover all services available on the local network.</span></span> <span data-ttu-id="2292d-150">Si se proporciona el nombre de instancia, se envía a la red local un tipo ANY (consultar el tipo SRV y TXT) con el nombre de instancia específico "name.type.local".</span><span class="sxs-lookup"><span data-stu-id="2292d-150">If the instance name is supplied, an ANY type (query the SRV and TXT type) with the specific instance name “name.type.local” is sent to the local network.</span></span> <span data-ttu-id="2292d-151">Si el nombre de instancia es NULL, se envía un tipo PTR de consulta a la red local.</span><span class="sxs-lookup"><span data-stu-id="2292d-151">If the instance name is NULL, a PTR type of query is sent to the local network,</span></span>

<span data-ttu-id="2292d-152">Todas las respuestas, incluidas las que proceden de las consultas no solicitadas, se registran en la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-152">All responses, including responses from unsolicited queries, are recorded in the peer service cache.</span></span> <span data-ttu-id="2292d-153">Posteriormente, la aplicación utiliza la API *nx_mdns_service_lookup* para recuperar un servicio específico de la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-153">At a later time, the application uses the API *nx_mdns_service_lookup* to retrieve specific service from the peer service cache.</span></span>

<span data-ttu-id="2292d-154">Nota especial sobre la fragmentación: cada estructura *NX_MDNS_RR* tiene un tamaño fijo y, por lo tanto, no está sujeta a la fragmentación, ya que mDNS agrega y elimina los registros de recursos.</span><span class="sxs-lookup"><span data-stu-id="2292d-154">Special note on fragmentation: Each *NX_MDNS_RR* structure is fixed in size, and therefore is not subject to fragmentation as mDNS adds and deletes RRs.</span></span> <span data-ttu-id="2292d-155">Sin embargo, las cadenas son de longitud variable.</span><span class="sxs-lookup"><span data-stu-id="2292d-155">However strings are variable length.</span></span> <span data-ttu-id="2292d-156">Una vez que se elimina una cadena, el espacio está disponible y se puede usar para la nueva cadena si cabe.</span><span class="sxs-lookup"><span data-stu-id="2292d-156">After a string is deleted, the space becomes available and could be used for a new string if the new string is able to fit in.</span></span> <span data-ttu-id="2292d-157">Sin embargo, esta operación hace que la memoria se fragmente.</span><span class="sxs-lookup"><span data-stu-id="2292d-157">But this operation causes the memory to fragment.</span></span> <span data-ttu-id="2292d-158">A medida que se agregan y quitan servicios, la tabla de cadenas se puede fragmentar hasta el punto de no poderse agregar cadenas nuevas aunque la caché de servicio contenga suficientes bytes no utilizados para la cadena.</span><span class="sxs-lookup"><span data-stu-id="2292d-158">As services are added and removed, the string table may be fragmented to the point that no new strings can be added even though the service cache contains enough unused bytes for the string.</span></span> <span data-ttu-id="2292d-159">Las aplicaciones locales suelen ser más estables y predecibles.</span><span class="sxs-lookup"><span data-stu-id="2292d-159">Local applications tend to be more stable and predictable.</span></span> <span data-ttu-id="2292d-160">Por lo tanto, es menos probable que la caché de servicio local sufra fragmentación.</span><span class="sxs-lookup"><span data-stu-id="2292d-160">Therefore the local service cache is less likely to suffer from fragmentation.</span></span> <span data-ttu-id="2292d-161">La caché de servicio del mismo nivel, por otro lado, agrega constantemente registros de recursos a medida que los servicios están disponibles, o bien los quita cuando los nodos de la red eliminan los servicios.</span><span class="sxs-lookup"><span data-stu-id="2292d-161">The peer service cache, on the other hand, constantly add RRs as the services become available, or remove RRs as services are deleted by the nodes on the network.</span></span> <span data-ttu-id="2292d-162">Los servicios de la red van y vienen, lo que provoca operaciones de asignación/eliminación más frecuentes en la tabla de cadenas.</span><span class="sxs-lookup"><span data-stu-id="2292d-162">Services on the network come and go, causing more frequent allocate/delete operations on the string table.</span></span> <span data-ttu-id="2292d-163">Con el tiempo, es posible que la tabla de cadenas se fragmente.</span><span class="sxs-lookup"><span data-stu-id="2292d-163">Over time it is possible the string table becomes fragmented.</span></span> <span data-ttu-id="2292d-164">Cuando se produce esta situación, una solución sencilla es vaciar toda la caché de servicio del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="2292d-164">When this situation happens, a simple solution is to flush the entire peer service cache.</span></span> <span data-ttu-id="2292d-165">Para ello, puede llamar a la API *nx_mdns_peer_cache_clear()* .</span><span class="sxs-lookup"><span data-stu-id="2292d-165">This can be done by calling the API *nx_mdns_peer_cache_clear().*</span></span> <span data-ttu-id="2292d-166">Tenga en cuenta que esta API finaliza automáticamente las consultas continuas pendientes.</span><span class="sxs-lookup"><span data-stu-id="2292d-166">Note that this API automatically terminates any outstanding continuous queries.</span></span>
