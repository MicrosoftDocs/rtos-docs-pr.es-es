---
title: 'Capítulo 1: Introducción a SNTP de Azure RTOS NetX Duo'
description: El protocolo simple de tiempo de redes (SNTP) de Azure RTOS NetX es un protocolo diseñado para sincronizar relojes a través de Internet.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: b3e1170197c6c4981060459104da80e354fac5db
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/22/2021
ms.locfileid: "104814554"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-sntp"></a><span data-ttu-id="2de05-103">Capítulo 1: Introducción a SNTP de Azure RTOS NetX Duo</span><span class="sxs-lookup"><span data-stu-id="2de05-103">Chapter 1 - Introduction to Azure RTOS NetX Duo SNTP</span></span> 

<span data-ttu-id="2de05-104">El protocolo simple de tiempo de redes (SNTP) de Azure RTOS NetX es un protocolo diseñado para sincronizar relojes a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="2de05-104">The Azure RTOS NetX Simple Network Time Protocol (SNTP) is a protocol designed for synchronizing clocks over the Internet.</span></span> <span data-ttu-id="2de05-105">La versión 4 de SNTP es un protocolo simplificado basado en el protocolo de tiempo de redes (NTP).</span><span class="sxs-lookup"><span data-stu-id="2de05-105">SNTP Version 4 is a simplified protocol based on the Network Time Protocol (NTP).</span></span> <span data-ttu-id="2de05-106">Emplea servicios de protocolo de datagramas de usuario (UDP) para realizar actualizaciones de hora con un protocolo simple sin estado.</span><span class="sxs-lookup"><span data-stu-id="2de05-106">It utilizes User Datagram Protocol (UDP) services to perform time updates in a simple, stateless protocol.</span></span> <span data-ttu-id="2de05-107">Aunque no es tan complejo como NTP, SNTP es muy confiable y preciso.</span><span class="sxs-lookup"><span data-stu-id="2de05-107">Though not as complex as NTP, SNTP is highly reliable and accurate.</span></span> <span data-ttu-id="2de05-108">En la mayoría de los lugares de Internet de hoy en día, SNTP proporciona una precisión de entre 1 y 50 milisegundos, en función de las características del origen de la sincronización y de las rutas de acceso de la red.</span><span class="sxs-lookup"><span data-stu-id="2de05-108">In most places of the Internet of today, SNTP provides accuracies of 1-50 milliseconds, depending on the characteristics of the synchronization source and network paths.</span></span> <span data-ttu-id="2de05-109">SNTP tiene muchas opciones para proporcionar confiabilidad a la hora de recibir las actualizaciones de hora.</span><span class="sxs-lookup"><span data-stu-id="2de05-109">SNTP has many options to provide reliability of receiving time updates.</span></span> <span data-ttu-id="2de05-110">La posibilidad de cambiar a servidores alternativos, la aplicación de interrupciones en los algoritmos de sondeo y la detección automática de servidores horarios son solo algunos de los medios de los que dispone un cliente SNTP para administrar un entorno variable de servicio horario de Internet.</span><span class="sxs-lookup"><span data-stu-id="2de05-110">Ability to switch to alternative servers, applying back off polling algorithms and automatic time server discovery are just a few of the means for an SNTP client to handle a variable Internet time service environment.</span></span> <span data-ttu-id="2de05-111">Lo que le falta en precisión lo compensa con la simplicidad y la facilidad de implementación que ofrece.</span><span class="sxs-lookup"><span data-stu-id="2de05-111">What it lacks in precision it makes up for in simplicity and ease of implementation.</span></span> <span data-ttu-id="2de05-112">SNTP está pensado principalmente para ofrecer mecanismos completos de acceso a los servicios nacionales de difusión de tiempo y frecuencia (por ejemplo, el servidor NTP).</span><span class="sxs-lookup"><span data-stu-id="2de05-112">SNTP is intended primarily for providing comprehensive mechanisms to access national time and frequency dissemination (e.g. NTP server) services.</span></span>

## <a name="netx-duo-sntp-client-requirements"></a><span data-ttu-id="2de05-113">Requisitos del cliente SNTP de NetX Duo</span><span class="sxs-lookup"><span data-stu-id="2de05-113">NetX Duo SNTP Client Requirements</span></span>

<span data-ttu-id="2de05-114">El cliente SNTP de NetX Duo requiere que ya se haya creado una instancia de IP.</span><span class="sxs-lookup"><span data-stu-id="2de05-114">The NetX Duo SNTP Client requires that an IP instance has already been created.</span></span> <span data-ttu-id="2de05-115">Además, debe estar habilitado el protocolo UDP en la misma instancia de IP y debe tener acceso al puerto *conocido* 123 para enviar datos de hora a un servidor SNTP, aunque también puede utilizar puertos alternativos.</span><span class="sxs-lookup"><span data-stu-id="2de05-115">In addition, UDP must be enabled on that same IP instance and should have access to the *well-known* port 123 for sending time data to an SNTP Server, although alternative ports will work as well.</span></span> <span data-ttu-id="2de05-116">Los clientes de difusión deben enlazar al puerto UDP por el que está enviando su servidor de difusión, normalmente 123.</span><span class="sxs-lookup"><span data-stu-id="2de05-116">Broadcast clients should bind the UDP port their broadcast server is sending on, usually 123.</span></span> <span data-ttu-id="2de05-117">La aplicación de cliente SNTP de NetX Duo debe tener una o varias direcciones IP de servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-117">The NetX Duo SNTP Client application must have one or more IP SNTP Server addresses.</span></span>

## <a name="netx-duo-sntp-client-limitations"></a><span data-ttu-id="2de05-118">Limitaciones del cliente SNTP de NetX Duo</span><span class="sxs-lookup"><span data-stu-id="2de05-118">NetX Duo SNTP Client Limitations</span></span> 

<span data-ttu-id="2de05-119">La precisión en la representación de la hora local en las actualizaciones de hora de NTP administradas por la API del cliente SNTP está limitada a una resolución de milisegundos.</span><span class="sxs-lookup"><span data-stu-id="2de05-119">Precision in local time representation in NTP time updates handled by the SNTP Client API is limited to millisecond resolution.</span></span>

<span data-ttu-id="2de05-120">El cliente SNTP incluye una única dirección de servidor SNTP a la vez.</span><span class="sxs-lookup"><span data-stu-id="2de05-120">The SNTP Client only holds a single SNTP Server address at any time.</span></span> <span data-ttu-id="2de05-121">Si parece que ese servidor ya no es válido, la aplicación debe detener la tarea del cliente SNTP y reinicializarla con otra dirección de servidor SNTP, mediante la comunicación de difusión o de unidifusión SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-121">If that Server appears to be no longer valid, the application must stop the SNTP Client task, and reinitialize it with another SNTP server address, using either broadcast or unicast SNTP communication.</span></span>

<span data-ttu-id="2de05-122">El cliente SNTP no es compatible con la difusión manycast a varios receptores.</span><span class="sxs-lookup"><span data-stu-id="2de05-122">The SNTP Client does not support manycast.</span></span>

<span data-ttu-id="2de05-123">El cliente SNTP de NetX Duo no es compatible con mecanismos de autenticación para comprobar los datos de los paquetes recibidos.</span><span class="sxs-lookup"><span data-stu-id="2de05-123">NetX Duo SNTP Client does not support authentication mechanisms for verifying received packet data.</span></span>

## <a name="netx-duo-sntp-client-operation"></a><span data-ttu-id="2de05-124">Funcionamiento del cliente SNTP de NetX Duo</span><span class="sxs-lookup"><span data-stu-id="2de05-124">NetX Duo SNTP Client Operation</span></span>

<span data-ttu-id="2de05-125">En la RFC 4330 se recomienda que los clientes SNTP solo funcionen en la capa más alta de la red local y preferiblemente con configuraciones en las que ningún cliente NTP o SNTP dependa de ellos para la sincronización.</span><span class="sxs-lookup"><span data-stu-id="2de05-125">RFC 4330 recommends that SNTP clients should operate only at the highest stratum of their local network and preferably in configurations where no NTP or SNTP client is dependent them for synchronization.</span></span> <span data-ttu-id="2de05-126">El nivel de capa refleja la posición del host en la jerarquía de tiempo de NTP, donde la capa 1 es el nivel más alto (un servidor horario raíz) y la capa 15 es el nivel mínimo permitido (por ejemplo, el cliente).</span><span class="sxs-lookup"><span data-stu-id="2de05-126">Stratum level reflects the host position in the NTP time hierarchy where stratum 1 is the highest level (a root time server) and 15 is the lowest allowed level (e.g. Client).</span></span> <span data-ttu-id="2de05-127">La capa mínima predeterminada del cliente SNTP es 2.</span><span class="sxs-lookup"><span data-stu-id="2de05-127">The SNTP Client default minimum stratum is 2.</span></span>

<span data-ttu-id="2de05-128">El cliente SNTP de NetX Duo puede funcionar en uno de dos modos básicos, unidifusión o difusión, para obtener la hora a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="2de05-128">The NetX Duo SNTP Client can operate in one of two basic modes, unicast or broadcast, to obtain time over the Internet.</span></span> <span data-ttu-id="2de05-129">En el modo de unidifusión, el cliente sondea su servidor SNTP a intervalos regulares y espera a recibir una respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="2de05-129">In unicast mode, the Client polls its SNTP Server on regular intervals and waits to receive a reply from that Server.</span></span> <span data-ttu-id="2de05-130">Cuando la recibe, comprueba que la respuesta contiene una actualización de hora válida mediante la aplicación de un conjunto de "comprobaciones de integridad" recomendado en la RFC 4330.</span><span class="sxs-lookup"><span data-stu-id="2de05-130">When one is received, the Client verifies that the reply contains a valid time update by applying a set of ‘sanity checks’ recommended by RFC 4330.</span></span> <span data-ttu-id="2de05-131">A continuación, aplica la diferencia de tiempo, si existe, con el reloj del servidor a su reloj local.</span><span class="sxs-lookup"><span data-stu-id="2de05-131">The Client then applies the time difference, if any, with the Server clock to its local clock.</span></span> <span data-ttu-id="2de05-132">En el modo de difusión, el cliente simplemente escucha las difusiones de actualización de hora y mantiene su reloj local después de aplicar un conjunto similar de comprobaciones de integridad para verificar los datos de hora de la actualización.</span><span class="sxs-lookup"><span data-stu-id="2de05-132">In broadcast mode, the Client merely listens for time update broadcasts and maintains its local clock after applying a similar set of sanity checks to verify the update time data.</span></span> <span data-ttu-id="2de05-133">Las comprobaciones de integridad se describen en detalle en la sección **Comprobaciones de integridad de SNTP**, más abajo.</span><span class="sxs-lookup"><span data-stu-id="2de05-133">Sanity checks are described in detail in the **SNTP Sanity Checks** section below.</span></span>

<span data-ttu-id="2de05-134">Para que el cliente pueda ejecutarse en cualquier modo, debe establecer sus parámetros operativos.</span><span class="sxs-lookup"><span data-stu-id="2de05-134">Before the Client can run in either mode, it must establish its operating parameters.</span></span> <span data-ttu-id="2de05-135">Esto se hace llamando a *nx_sntp_client_initialize_unicast* o a *nx_sntp_client_initialize_broadcast* para los modos de unidifusión o difusión, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="2de05-135">This is done by calling either *nx_sntp_client_initialize_unicast* or *nx_sntp_client_initialize_broadcast* for unicast or broadcast modes, respectively.</span></span> <span data-ttu-id="2de05-136">Estos servicios establecen los tiempos de espera para el intervalo máximo de tiempo sin una actualización válida, el límite de actualizaciones no válidas consecutivas recibidas, un intervalo de sondeo para el modo de unidifusión, el modo de operación (es decir, unidifusión o difusión) y el servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-136">These serves set the time outs for maximum time lapse without a valid update, the limit on consecutive invalid updates received, a polling interval for unicast mode, operation mode e.g. unicast vs. broadcast, and SNTP Server.</span></span>

<span data-ttu-id="2de05-137">Si se supera el intervalo máximo de tiempo o el número máximo de actualizaciones no válidas recibidas, el cliente SNTP continúa ejecutándose, pero establece el estado del servidor SNTP actual en no válido.</span><span class="sxs-lookup"><span data-stu-id="2de05-137">If the maximum time lapse or maximum invalid updates received is exceeded, the SNTP Client continues to run but sets the current SNTP Server status to invalid.</span></span> <span data-ttu-id="2de05-138">La aplicación puede sondear el cliente SNTP mediante el servicio *nx_sntp_client_receiving_updates* para comprobar que el servidor SNTP todavía está enviando actualizaciones válidas.</span><span class="sxs-lookup"><span data-stu-id="2de05-138">The application can poll the SNTP Client using the *nx_sntp_client_receiving_updates* service to verify the SNTP Server is still sending valid updates.</span></span> <span data-ttu-id="2de05-139">Si no es así, debe detener el subproceso del cliente SNTP mediante el servicio *nx_sntp_client_stop* y llamar a cualquiera de los dos servicios de inicialización para establecer otra dirección de servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-139">If not, it should stop the SNTP Client thread using the *nx_sntp_client_stop* service and call either of the two initialize services to set another SNTP Server address.</span></span> <span data-ttu-id="2de05-140">Para reiniciar el cliente SNTP, la aplicación llama a *nx_sntp_client_run_broadcast* o a *nx_sntp_client_run_unicast*.</span><span class="sxs-lookup"><span data-stu-id="2de05-140">To restart the SNTP Client, the application calls *nx_sntp_client_run_broadcast* or *nx_sntp_client_run_unicast*.</span></span> <span data-ttu-id="2de05-141">Tenga en cuenta que la aplicación puede cambiar el modo de funcionamiento del cliente SNTP en la llamada de inicialización para pasar a unidifusión o difusión, según interese.</span><span class="sxs-lookup"><span data-stu-id="2de05-141">Note that the application can change SNTP Client operating mode in the initialize call to switch to unicast or broadcast as desired.</span></span>

### <a name="local-clock-operation"></a><span data-ttu-id="2de05-142">Funcionamiento del reloj local</span><span class="sxs-lookup"><span data-stu-id="2de05-142">Local Clock Operation</span></span>

<span data-ttu-id="2de05-143">La hora de SNTP se basa en el número de segundos del reloj NTP maestro, o lo que es lo mismo, en el número de segundos transcurridos en la primera época de NTP, desde el 1 de enero de **1900 a las 00:00:00 hasta** el 1 de enero de **1999 a las 00:00:00**.</span><span class="sxs-lookup"><span data-stu-id="2de05-143">The SNTP time based on the number of seconds on the master NTP clock, or number of seconds elapsed in the first NTP epoch e.g. from Jan 1 **1900 00:00:00 to** Jan 1 **1999 00:00:00**.</span></span> <span data-ttu-id="2de05-144">El 01-01-1999 fue cuando se produjo el último segundo intercalar.</span><span class="sxs-lookup"><span data-stu-id="2de05-144">The significance of 01-01-1999 was when the last leap second occurred.</span></span> <span data-ttu-id="2de05-145">Este valor se define de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="2de05-145">This value is defined as follows:</span></span>

<span data-ttu-id="2de05-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span><span class="sxs-lookup"><span data-stu-id="2de05-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span></span>

<span data-ttu-id="2de05-147">Antes de que se ejecute el cliente SNTP, la aplicación puede inicializar la hora local del cliente SNTP para que el cliente la use como hora base de referencia.</span><span class="sxs-lookup"><span data-stu-id="2de05-147">Before the SNTP Client runs, the application can optionally initialize the SNTP Client local time for the Client to use as a baseline time.</span></span> <span data-ttu-id="2de05-148">Para ello, debe usar el servicio *nx_sntp_client_set_local_time*.</span><span class="sxs-lookup"><span data-stu-id="2de05-148">To do so, it must use the *nx_sntp_client_set_local_time* service.</span></span> <span data-ttu-id="2de05-149">Este servicio recibe la hora en formato de NTP de segundos y fracción, donde la fracción son los milisegundos en el tiempo condensado de NTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-149">This takes the time in NTP format, seconds and fraction, where fraction is the milliseconds in the NTP condensed time.</span></span> <span data-ttu-id="2de05-150">Idealmente, la aplicación puede obtener una hora de SNTP de un origen independiente.</span><span class="sxs-lookup"><span data-stu-id="2de05-150">Ideally the application can obtain an SNTP time from an independent source.</span></span> <span data-ttu-id="2de05-151">No hay ninguna API para convertir el año, el mes, el día y la hora a una hora de NTP en el cliente SNTP de NetX Duo.</span><span class="sxs-lookup"><span data-stu-id="2de05-151">There is no API for converting year, month, date and time to an NTP time in the NetX Duo SNTP Client.</span></span> <span data-ttu-id="2de05-152">Para obtener una descripción del formato de hora de NTP, consulte la *RFC4330 de protocolo simple de tiempo de redes (SNTP) versión 4 para IPv4, IPv6 y OSI*.</span><span class="sxs-lookup"><span data-stu-id="2de05-152">For a description of NTP time format, refer to *RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI”.*</span></span>

<span data-ttu-id="2de05-153">Si no se proporciona ninguna hora local base cuando se inicia el cliente SNTP, este aceptará las actualizaciones de SNTP sin compararlas con su hora local en la primera actualización.</span><span class="sxs-lookup"><span data-stu-id="2de05-153">If no base local time is supplied when the SNTP Client starts up, the SNTP Client will accept the SNTP updates without comparing to its local time on the first update.</span></span> <span data-ttu-id="2de05-154">A partir de ese momento, aplicará los valores máximo y mínimo de actualización de hora para determinar si va a modificar su hora local.</span><span class="sxs-lookup"><span data-stu-id="2de05-154">Thereafter it will apply the maximum and minimum time update values to determine if it will modify its local time.</span></span>

<span data-ttu-id="2de05-155">Para obtener la hora local del cliente SNTP, la aplicación puede utilizar el servicio *nx_sntp_client_get_local_time_extended*.</span><span class="sxs-lookup"><span data-stu-id="2de05-155">To obtain the SNTP Client local time, the application can use the *nx_sntp_client_get_local_time_extended* service.</span></span>

### <a name="sntp-sanity-checks"></a><span data-ttu-id="2de05-156">Comprobaciones de integridad de SNTP</span><span class="sxs-lookup"><span data-stu-id="2de05-156">SNTP Sanity Checks</span></span> 

<span data-ttu-id="2de05-157">El cliente examina el paquete entrante con los siguientes criterios:</span><span class="sxs-lookup"><span data-stu-id="2de05-157">The Client examines the incoming packet for the following criteria:</span></span>

  - <span data-ttu-id="2de05-158">La dirección IP de origen debe coincidir con la dirección IP del servidor actual.</span><span class="sxs-lookup"><span data-stu-id="2de05-158">Source IP address must match the current server IP address.</span></span>

  - <span data-ttu-id="2de05-159">El puerto de origen del emisor debe coincidir con el puerto de origen del servidor actual.</span><span class="sxs-lookup"><span data-stu-id="2de05-159">Sender source port must match with the current server source port.</span></span>

  - <span data-ttu-id="2de05-160">El paquete debe tener la longitud mínima necesaria para incluir un mensaje de hora de SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-160">Packet length must be the minimum length to hold an SNTP time message.</span></span>

<span data-ttu-id="2de05-161">A continuación, se extraen los datos de hora del búfer del paquete y el cliente aplica un conjunto de "comprobaciones de integridad" específicas:</span><span class="sxs-lookup"><span data-stu-id="2de05-161">Next, the time data is extracted from the packet buffer to which the Client then applies a set of specific ‘sanity checks’:</span></span>

  - <span data-ttu-id="2de05-162">El indicador de segundo intercalar establecido en 3 indica que el servidor no está sincronizado.</span><span class="sxs-lookup"><span data-stu-id="2de05-162">The Leap Indicator set to 3 indicates the Server is not synchronized.</span></span> <span data-ttu-id="2de05-163">El cliente debe intentar buscar un servidor alternativo.</span><span class="sxs-lookup"><span data-stu-id="2de05-163">The Client should attempt to find an alternative server.</span></span>

  - <span data-ttu-id="2de05-164">Un campo de capa establecido en cero se conoce como paquete de beso de la muerte (KOD).</span><span class="sxs-lookup"><span data-stu-id="2de05-164">A stratum field set to zero is known as a Kiss of Death (KOD) packet.</span></span> <span data-ttu-id="2de05-165">El controlador de KOD del cliente SMTP en esta situación es una devolución de llamada definida por el usuario.</span><span class="sxs-lookup"><span data-stu-id="2de05-165">The SMTP Client KOD handler for this situation is a user defined callback.</span></span> <span data-ttu-id="2de05-166">El pequeño archivo de demostración de ejemplo contiene un controlador de KOD simple para esta situación.</span><span class="sxs-lookup"><span data-stu-id="2de05-166">The small example demo file contains a simple KOD handler for this situation.</span></span> <span data-ttu-id="2de05-167">El campo de identificador de referencia contiene opcionalmente un código que indica el motivo de la respuesta de KOD.</span><span class="sxs-lookup"><span data-stu-id="2de05-167">The Reference ID field optionally contains a code indicating the reason for the KOD reply.</span></span> <span data-ttu-id="2de05-168">En cualquier momento, el controlador de KOD debe indicar cómo administrar la recepción de un beso de la muerte del servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-168">At any rate, the KOD handler must indicate how to handle receiving a kiss of death from the SNTP Server.</span></span> <span data-ttu-id="2de05-169">Normalmente, querrá reinicializar el cliente SNTP con otro servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-169">Typically it will want to reinitialize the SNTP Client with another SNTP Server.</span></span>

  - <span data-ttu-id="2de05-170">La versión del servidor SNTP, la capa y el modo de funcionamiento deben coincidir con el servicio del cliente.</span><span class="sxs-lookup"><span data-stu-id="2de05-170">The Server SNTP version, stratum and mode of operation must be matched to the Client service.</span></span>

  - <span data-ttu-id="2de05-171">Si el cliente se configura con el máximo de dispersión del reloj del servidor, el cliente solo comprueba la dispersión del reloj del servidor en la primera actualización que recibe y, si supera el máximo del cliente, rechaza el servidor.</span><span class="sxs-lookup"><span data-stu-id="2de05-171">If the Client is configured with a server clock dispersion maximum, the Client checks the server clock dispersion on the first update received only, and if it exceeds the Client maximum, the Client rejects the Server.</span></span>

  - <span data-ttu-id="2de05-172">Los campos de marca de tiempo del servidor también deben superar comprobaciones específicas.</span><span class="sxs-lookup"><span data-stu-id="2de05-172">The Server time stamp fields must also pass specific checks.</span></span> <span data-ttu-id="2de05-173">En el caso del servidor de unidifusión, todos los campos de hora deben incluir contenido y no pueden ser NULL.</span><span class="sxs-lookup"><span data-stu-id="2de05-173">For the unicast Server, all time fields must be filled in and cannot be NULL.</span></span> <span data-ttu-id="2de05-174">La marca de tiempo de origen debe ser igual a la marca de tiempo de transmisión de la solicitud de mensaje de hora SNTP del cliente.</span><span class="sxs-lookup"><span data-stu-id="2de05-174">The Origination time stamp must equal the Transmit time stamp in the Client’s SNTP time message request.</span></span> <span data-ttu-id="2de05-175">Esto protege al cliente ante intrusos malintencionados y un comportamiento de servidor no autorizado.</span><span class="sxs-lookup"><span data-stu-id="2de05-175">This protects the Client from malicious intruders and rogue Server behavior.</span></span> <span data-ttu-id="2de05-176">El servidor de difusión solo necesita rellenar la marca de tiempo de transmisión.</span><span class="sxs-lookup"><span data-stu-id="2de05-176">The broadcast Server need only fill in the Transmit time stamp.</span></span> <span data-ttu-id="2de05-177">Dado que no recibe nada del cliente, no tiene ningún campo de recepción ni de origen que rellenar.</span><span class="sxs-lookup"><span data-stu-id="2de05-177">Since it does not receive anything from the Client it has no Receive or Origination fields to fill in.</span></span>

    <span data-ttu-id="2de05-178">Una comprobación de integridad con errores marca una actualización de hora como una actualización de hora no válida.</span><span class="sxs-lookup"><span data-stu-id="2de05-178">A failed sanity check brands a time update as an invalid time update.</span></span> <span data-ttu-id="2de05-179">El servicio de comprobación de integridad del cliente SNTP realiza un seguimiento del número de actualizaciones de hora no válidas consecutivas recibidas del mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="2de05-179">The SNTP Client sanity check service tracks the number of consecutive invalid time updates received from the same Server.</span></span>

<span data-ttu-id="2de05-180">Cuando la tarea de subproceso del cliente SNTP comprueba la validez de un paquete SNTP para aplicarlo a la hora local del cliente SNTP, incrementa el recuento del servicio `nx_sntp_client_invalid_time_updates.` del cliente SNTP. También devuelve un estado de error al autor de la llamada, pero se trata de un procesamiento interno, por lo que no es inmediatamente visible para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2de05-180">When SNTP Client thread task checks the validity of an SNTP packet for applying to the local SNTP Client time, it increments the count of the SNTP Client `nx_sntp_client_invalid_time_updates.` It also returns an error status to the caller but this is all internal processing so it is not immediately visible to the application.</span></span> <span data-ttu-id="2de05-181">Para detectar actualizaciones de hora con errores se consulta el valor del servicio `nx_sntp_client_invalid_time_updates` del cliente SNTP después de recibir las actualizaciones de hora del servidor SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-181">The way to detect failed time updates is to query the value of the SNTP Client `nx_sntp_client_invalid_time_updates` after receiving SNTP Server time updates.</span></span>

<span data-ttu-id="2de05-182">Si la actualización de hora del servidor supera las comprobaciones de integridad, el cliente intenta procesar los datos de hora a su hora local.</span><span class="sxs-lookup"><span data-stu-id="2de05-182">If the Server time update passes the sanity checks, the Client then attempts to process the time data to its local time.</span></span> <span data-ttu-id="2de05-183">Si el cliente está configurado para el cálculo del recorrido de ida y vuelta (por ejemplo, el tiempo desde que se envía una solicitud de actualización hasta que se recibe), se calcula este tiempo.</span><span class="sxs-lookup"><span data-stu-id="2de05-183">If the Client is configured for round trip calculation, e.g. the time from sending an update request to the time one is received, the round trip time is calculated.</span></span> <span data-ttu-id="2de05-184">El valor se reduce a la mitad y se agrega a la hora del servidor.</span><span class="sxs-lookup"><span data-stu-id="2de05-184">This value is halved and then added to the Server’s time.</span></span>

<span data-ttu-id="2de05-185">Después, si se trata de la primera actualización que se recibe del servidor SNTP actual, el cliente SNTP determina si debe pasar por alto la diferencia entre la hora local del servidor y la del cliente.</span><span class="sxs-lookup"><span data-stu-id="2de05-185">Next, if this is the first update received from the current SNTP Server, the SNTP Client determines if it should ignore the difference between the Server and Client local time.</span></span> <span data-ttu-id="2de05-186">A partir de ese momento, se evalúan todas las actualizaciones del servidor SNTP para detectar la diferencia con la hora local del cliente.</span><span class="sxs-lookup"><span data-stu-id="2de05-186">Thereafter all updates from the SNTP Server are evaluated for the difference with the Client local time.</span></span>

<span data-ttu-id="2de05-187">La diferencia entre la hora del cliente y del servidor se compara con el valor de `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span><span class="sxs-lookup"><span data-stu-id="2de05-187">The difference between Client and Server time is compared with `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span></span> <span data-ttu-id="2de05-188">Si supera este valor, los datos se descartan. Si la diferencia es menor que el valor de `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT`, se considera demasiado pequeña para necesitar ajuste.</span><span class="sxs-lookup"><span data-stu-id="2de05-188">If it exceeds this value, the data is thrown out. If the difference is less than the `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` the difference is considered too small to require adjustment.</span></span>

<span data-ttu-id="2de05-189">Tras superar todas estas comprobaciones, la actualización de hora se aplica al cliente SNTP con algunas correcciones por los retrasos en el procesamiento interno del cliente SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-189">Passing all these checks, the time update is then applied to the SNTP Client with some corrections for delays in internal SNTP Client processing.</span></span>

### <a name="sntp-asynchronous-unicast-requests"></a><span data-ttu-id="2de05-190">Solicitudes asincrónicas de unidifusión SNTP</span><span class="sxs-lookup"><span data-stu-id="2de05-190">SNTP Asynchronous Unicast Requests</span></span> 

<span data-ttu-id="2de05-191">El cliente SNTP permite que la aplicación host envíe de forma asincrónica una solicitud de unidifusión de la hora actual desde el servidor NTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-191">The SNTP Client allows the host application to asynchronously send a unicast request for the current time from the NTP server.</span></span>

```C
UINT _nx_sntp_client_request_unicast_time(
NX_SNTP_CLIENT *client_ptr, 
UINT wait_option)
```

<span data-ttu-id="2de05-192">La opción de espera indica cuándo se deja de esperar una respuesta.</span><span class="sxs-lookup"><span data-stu-id="2de05-192">The wait option is the expiration to wait for a response.</span></span>

<span data-ttu-id="2de05-193">Si el servidor NTP responde, el paquete está sujeto al mismo procesamiento y las mismas comprobaciones de integridad que se han descrito en la sección anterior antes de actualizar la hora local del cliente SNTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-193">If the NTP Server responds, the packet is subjected to the same processing and sanity checks as described in the previous section before updating the SNTP Client local time.</span></span>

<span data-ttu-id="2de05-194">Si la llamada devuelve una finalización correcta, la aplicación puede llamar a *nx_sntp_client_utility_display_date_time* o a *nx_sntp_client_get_local_time_extended* para obtener la hora local actualizada.</span><span class="sxs-lookup"><span data-stu-id="2de05-194">If the call returns successful completion, the application can call *nx_sntp_client_utility_display_date_time* or *nx_sntp_client_get_local_time_extended* for the updated local time.</span></span>

<span data-ttu-id="2de05-195">Estas solicitudes de unidifusión no interfieren con la programación normal del cliente SNTP para enviar la siguiente solicitud de unidifusión ni, en el modo de difusión, con el momento en el que se espera la siguiente difusión NTP.</span><span class="sxs-lookup"><span data-stu-id="2de05-195">These unicast requests do not interfere with the normal SNTP Client schedule for sending the next unicast request, or if in broadcast mode, when to expect the next NTP broadcast.</span></span>

### <a name="periodic-local-time-updates"></a><span data-ttu-id="2de05-196">Actualizaciones periódicas de la hora local</span><span class="sxs-lookup"><span data-stu-id="2de05-196">Periodic Local Time Updates</span></span>

<span data-ttu-id="2de05-197">El ajuste máximo de la hora local se establece en la opción NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT (en milisegundos).</span><span class="sxs-lookup"><span data-stu-id="2de05-197">The maximum adjustment to the local time is set in the NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT option (in milliseconds).</span></span> <span data-ttu-id="2de05-198">El intervalo de actualización de sondeo para las operaciones de unidifusión del cliente SNTP se establece en la opción NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL (en segundos).</span><span class="sxs-lookup"><span data-stu-id="2de05-198">The polling update interval for unicast SNTP Client operations is set in the NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL option (in seconds).</span></span> <span data-ttu-id="2de05-199">Si el intervalo de sondeo es mayor que el ajuste máximo, se rechazarán las actualizaciones del servidor siguientes a la primera actualización.</span><span class="sxs-lookup"><span data-stu-id="2de05-199">If the polling interval is greater than the maximum adjustment, then subsequent server updates after the first server update will be rejected.</span></span> <span data-ttu-id="2de05-200">Para evitar que esto suceda, el cliente SNTP actualizará la hora local que se define periódicamente como NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span><span class="sxs-lookup"><span data-stu-id="2de05-200">To prevent this, the SNTP Client will update the local time periodically defined as NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span></span> 

<span data-ttu-id="2de05-201">Si hay una diferencia en la hora entre el RTC incorporado y el servidor (la hora en la que se debe establecer la hora local del cliente SNTP), el RTC se debe sincronizar con la hora del cliente SNTP (esta operación no se muestra en este manual del usuario).</span><span class="sxs-lookup"><span data-stu-id="2de05-201">If there is a difference in time between the on board RTC and the server time (which the SNTP Client local time should be set to), the RTC should be synched to the SNTP Client time (we do not demonstrate that in this User Guide).</span></span>

<span data-ttu-id="2de05-202">Puesto que las actualizaciones del servidor SNTP no deben producirse más de una vez por hora, no resulta útil sondear el cliente SNTP para ver si hay actualizaciones del servidor o para conocer el estado del servidor con más frecuencia.</span><span class="sxs-lookup"><span data-stu-id="2de05-202">Since SNTP server updates should not occur more often than once per hour, it is not useful to poll the SNTP Client for server updates or server status more often than that.</span></span> <span data-ttu-id="2de05-203">Sin embargo, el cliente SNTP debe actualizar su reloj local con la frecuencia suficiente como para no superar el parámetro de ajuste de tiempo máximo NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span><span class="sxs-lookup"><span data-stu-id="2de05-203">However, the SNTP Client should update its local clock often enough not to fall further than the maximum time adjustment parameter NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span></span>

<span data-ttu-id="2de05-204">Como alternativa, se puede establecer el ajuste máximo NX_SNTP_CLIENT_MAX_TIME_LAPSE en un valor mayor que la actualización de sondeo de unidifusión (o intervalos de difusión anticipados).</span><span class="sxs-lookup"><span data-stu-id="2de05-204">Alternatively, the maximum adjustment NX_SNTP_CLIENT_MAX_TIME_LAPSE can be set to greater than the unicast polling update (or anticipated broadcast intervals).</span></span> <span data-ttu-id="2de05-205">En este último caso se elimina la necesidad de un reloj en tiempo real independiente.</span><span class="sxs-lookup"><span data-stu-id="2de05-205">The latter eliminates the need for an independent real time clock.</span></span> <span data-ttu-id="2de05-206">Sin embargo, la intención del protocolo SNTP es evitar la dependencia total de las actualizaciones de hora de la red o del RTC local.</span><span class="sxs-lookup"><span data-stu-id="2de05-206">However, the intention of SNTP protocol is to avoid total reliance on either local RTC or network time updates.</span></span> <span data-ttu-id="2de05-207">Además, las actualizaciones del servidor SNTP están diseñadas para evitar el desfase en el reloj de hora local.</span><span class="sxs-lookup"><span data-stu-id="2de05-207">Further, the SNTP Server updates are intended to prevent drift in the local time clock.</span></span>

## <a name="multiple-network-interfaces"></a><span data-ttu-id="2de05-208">Varias interfaces de red</span><span class="sxs-lookup"><span data-stu-id="2de05-208">Multiple Network Interfaces</span></span>

<span data-ttu-id="2de05-209">El cliente SNTP de NetX Duo se puede configurar para ejecutarse en redes secundarias, siempre y cuando esas redes estén registradas con la instancia de IP.</span><span class="sxs-lookup"><span data-stu-id="2de05-209">NetX Duo SNTP Client can be configured to run on secondary networks as long as those networks are registered with the IP instance.</span></span> <span data-ttu-id="2de05-210">Consulte el manual del usuario de NetX Duo o NetX para obtener más información sobre cómo registrar redes secundarias.</span><span class="sxs-lookup"><span data-stu-id="2de05-210">See the NetX Duo or NetX User Guide for more information on how to register secondary networks.</span></span>

<span data-ttu-id="2de05-211">En la llamada a *nx_sntp_client_create*, establezca la tercera entrada, iface_index, en el índice de la red donde el cliente SNTP recibirá las actualizaciones de hora.</span><span class="sxs-lookup"><span data-stu-id="2de05-211">In the *nx_sntp_client_create* call, set the third input, iface_index, to the index of the network for the SNTP Client to receive time updates on.</span></span> <span data-ttu-id="2de05-212">La interfaz principal siempre está en el índice 0.</span><span class="sxs-lookup"><span data-stu-id="2de05-212">The primary interface is always at index 0.</span></span> <span data-ttu-id="2de05-213">El cliente SNTP de NetX Duo no admite actualizaciones de hora simultáneamente en varias interfaces de red.</span><span class="sxs-lookup"><span data-stu-id="2de05-213">NetX Duo SNTP Client cannot support time updates simultaneously on multiple network interface.</span></span>

## <a name="sntp-and-ntp-rfcs"></a><span data-ttu-id="2de05-214">Publicaciones RFC para SNTP y NTP</span><span class="sxs-lookup"><span data-stu-id="2de05-214">SNTP and NTP RFCs</span></span>

<span data-ttu-id="2de05-215">El cliente SNTP de NetX Duo es compatible con la RFC4330 de protocolo simple de tiempo de redes (SNTP) versión 4 para IPv4, IPv6 y OSI y otras RFC relacionadas.</span><span class="sxs-lookup"><span data-stu-id="2de05-215">NetX Duo SNTP client is compliant with RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI” and related RFCs.</span></span>