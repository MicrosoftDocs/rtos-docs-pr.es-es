---
title: 'Capítulo 6: Módulo de tolerancia a errores de Azure RTOS FileX'
description: Este capítulo contiene una descripción del módulo de tolerancia a errores de Azure RTOS FileX que está diseñado para mantener la integridad del sistema de archivos si el soporte físico pierde energía o se expulsa en mitad de una operación de escritura de archivo.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815057"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="35846-103">Capítulo 6: Módulo de tolerancia a errores de Azure RTOS FileX</span><span class="sxs-lookup"><span data-stu-id="35846-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="35846-104">Este capítulo contiene una descripción del módulo de tolerancia a errores de Azure RTOS FileX que está diseñado para mantener la integridad del sistema de archivos si el soporte físico pierde energía o se expulsa en mitad de una operación de escritura de archivo.</span><span class="sxs-lookup"><span data-stu-id="35846-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="35846-105">Información general del módulo de tolerancia a errores de FileX</span><span class="sxs-lookup"><span data-stu-id="35846-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="35846-106">Cuando una aplicación escribe datos en un archivo, FileX actualiza los clústeres de datos y la información del sistema.</span><span class="sxs-lookup"><span data-stu-id="35846-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="35846-107">Estas actualizaciones se deben completar como una operación atómica para mantener coherente la información en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="35846-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="35846-108">Por ejemplo, al anexar datos a un archivo, FileX necesita encontrar un clúster disponible en el soporte físico, actualizar la cadena FAT, actualizar la longitud presentada en la entrada de directorio y, posiblemente, actualizar el número de clúster de inicio en la entrada del directorio.</span><span class="sxs-lookup"><span data-stu-id="35846-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="35846-109">Un error de potencia o una extracción del soporte físico pueden interrumpir la secuencia de actualizaciones, lo que dejará el sistema de archivos en un estado incoherente.</span><span class="sxs-lookup"><span data-stu-id="35846-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="35846-110">Si no se corrige el estado incoherente, se pueden perder los datos que se están actualizando y, debido a los daños en la información del sistema, la operación posterior del sistema de archivos puede dañar otros archivos o directorios del soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="35846-111">El módulo de tolerancia a errores de FileX funciona con los pasos de registro en diario necesarios para actualizar un archivo *antes* de que estos pasos se apliquen en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="35846-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="35846-112">Si la actualización del archivo se realiza correctamente, se quitan las entradas de registro.</span><span class="sxs-lookup"><span data-stu-id="35846-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="35846-113">Sin embargo, si se interrumpe la actualización del archivo, las entradas de registro se almacenan en el soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="35846-114">La próxima vez que se monte el soporte físico, FileX detectará estas entradas de registro de la operación de escritura anterior (sin terminar).</span><span class="sxs-lookup"><span data-stu-id="35846-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="35846-115">En tales casos, FileX puede recuperarse de un error revirtiendo los cambios ya realizados en el sistema de archivos o volviendo a aplicar los cambios necesarios para completar la operación anterior.</span><span class="sxs-lookup"><span data-stu-id="35846-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="35846-116">De esta manera, el módulo de tolerancia a errores de FileX mantiene la integridad del sistema de archivos si el soporte físico pierde energía durante una operación de actualización.</span><span class="sxs-lookup"><span data-stu-id="35846-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="35846-117">*El módulo de tolerancia a errores de FileX no está diseñado para evitar daños en el sistema de archivos causados por daños en soportes físicos con datos válidos.*</span><span class="sxs-lookup"><span data-stu-id="35846-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="35846-118">*Después de que el módulo de tolerancia a errores de FileX proteja un soporte físico, este soporte físico solo debe montarse con FileX con la tolerancia a errores habilitada. Si no, las entradas de registro del sistema de archivos pueden no ser coherentes con la información del sistema en el soporte físico. Si el módulo de tolerancia a errores de FileX intenta procesar las entradas de registro después de que otro sistema de archivos actualice el soporte físico, el procedimiento de recuperación puede producir un error, lo que dejaría todo el sistema de archivos en un estado impredecible.*</span><span class="sxs-lookup"><span data-stu-id="35846-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="35846-119">Uso del módulo de tolerancia a errores</span><span class="sxs-lookup"><span data-stu-id="35846-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="35846-120">La característica de tolerancia a errores de FileX está disponible para todos los sistemas de archivos FAT soportados por FileX, como FAT12, FAT16, FAT32 y exFAT.</span><span class="sxs-lookup"><span data-stu-id="35846-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="35846-121">Para habilitar la característica de tolerancia a errores, FileX se debe crear con el símbolo **FX_ENABLE_FAULT_TOLERANT** definido.</span><span class="sxs-lookup"><span data-stu-id="35846-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="35846-122">En el tiempo de ejecución, la aplicación inicia el servicio de tolerancia a errores mediante una llamada a **_fx_fault_tolerant_enable_ *_ inmediatamente después de la llamada a _* _fx_media_open_**.</span><span class="sxs-lookup"><span data-stu-id="35846-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="35846-123">Una vez habilitada la tolerancia a errores, se protegen todas las operaciones de escritura de archivos en los soportes físicos designados.</span><span class="sxs-lookup"><span data-stu-id="35846-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="35846-124">De forma predeterminada, el módulo de tolerancia a errores no está habilitado.</span><span class="sxs-lookup"><span data-stu-id="35846-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="35846-125">\*La aplicación debe asegurarse de que no se tiene acceso al sistema de archivos antes de la llamada a \***fx_fault_tolerant_enable** _.</span><span class="sxs-lookup"><span data-stu-id="35846-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="35846-126">Si la aplicación escribe datos en el sistema de archivos antes de la habilitación de tolerancia a errores, la operación de escritura podría dañar el soporte físico si no se completaron las operaciones de escritura anteriores y el sistema de archivos no se restauró mediante las entradas de registro de tolerancia a errores._</span><span class="sxs-lookup"><span data-stu-id="35846-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="35846-127">Módulo de tolerancia a errores de FileX</span><span class="sxs-lookup"><span data-stu-id="35846-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="35846-128">El registro de tolerancia a errores de FileX usa un clúster lógico en flash.</span><span class="sxs-lookup"><span data-stu-id="35846-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="35846-129">El índice para el número de clústeres de inicio de ese clúster se registra en el sector de arranque del soporte físico, con un desplazamiento especificado por el símbolo **FX_FAULT_TOLERANT_BOOT_INDEX**.</span><span class="sxs-lookup"><span data-stu-id="35846-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="35846-130">De forma predeterminada, este símbolo está definido como 116.</span><span class="sxs-lookup"><span data-stu-id="35846-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="35846-131">Esta ubicación se elige porque está marcada como reservada en las especificaciones FAT12/16/32 y exFAT.</span><span class="sxs-lookup"><span data-stu-id="35846-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="35846-132">En la figura 5, "diseño de la estructura del registro", se muestra el diseño general de la estructura del registro.</span><span class="sxs-lookup"><span data-stu-id="35846-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="35846-133">La estructura del registro contiene tres secciones: encabezado del registro, cadena FAT y entradas de registro.</span><span class="sxs-lookup"><span data-stu-id="35846-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="35846-134">*Todos los valores multibyte almacenados en las entradas de registro están en formato Little Endian.*</span><span class="sxs-lookup"><span data-stu-id="35846-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![Diseño de la estructura del registro](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="35846-136">**Figura 5. Diseño de la estructura del registro**</span><span class="sxs-lookup"><span data-stu-id="35846-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="35846-137">El área de encabezado del registro contiene información que describe la estructura del registro completa y explica detalladamente cada campo.</span><span class="sxs-lookup"><span data-stu-id="35846-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="35846-138">**TABLA 8. Área de encabezado del registro**</span><span class="sxs-lookup"><span data-stu-id="35846-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="35846-139">Campo</span><span class="sxs-lookup"><span data-stu-id="35846-139">Field</span></span>|<span data-ttu-id="35846-140">Tamaño (en bytes)</span><span class="sxs-lookup"><span data-stu-id="35846-140">Size(in bytes)</span></span>|<span data-ttu-id="35846-141">Descripción</span><span class="sxs-lookup"><span data-stu-id="35846-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="35846-142">ID</span><span class="sxs-lookup"><span data-stu-id="35846-142">ID</span></span>|<span data-ttu-id="35846-143">4</span><span class="sxs-lookup"><span data-stu-id="35846-143">4</span></span>|<span data-ttu-id="35846-144">Identifica una estructura del registro de tolerancia a errores de FileX.</span><span class="sxs-lookup"><span data-stu-id="35846-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="35846-145">La estructura del registro no se considera válida si el valor de id. no es 0x46544C52.</span><span class="sxs-lookup"><span data-stu-id="35846-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="35846-146">Tamaño total</span><span class="sxs-lookup"><span data-stu-id="35846-146">Total Size</span></span>|<span data-ttu-id="35846-147">2</span><span class="sxs-lookup"><span data-stu-id="35846-147">2</span></span>|<span data-ttu-id="35846-148">Indica el tamaño total (en bytes) de toda la estructura del registro.</span><span class="sxs-lookup"><span data-stu-id="35846-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="35846-149">Suma de comprobación del encabezado</span><span class="sxs-lookup"><span data-stu-id="35846-149">Header Checksum</span></span>|<span data-ttu-id="35846-150">2</span><span class="sxs-lookup"><span data-stu-id="35846-150">2</span></span>|<span data-ttu-id="35846-151">Suma de comprobación que convierte el área del encabezado del registro.</span><span class="sxs-lookup"><span data-stu-id="35846-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="35846-152">La estructura del registro no se considera válida si los campos del encabezado no coinciden con la comprobación de la suma de comprobación.</span><span class="sxs-lookup"><span data-stu-id="35846-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="35846-153">Número de versión</span><span class="sxs-lookup"><span data-stu-id="35846-153">Version Number</span></span>|<span data-ttu-id="35846-154">2</span><span class="sxs-lookup"><span data-stu-id="35846-154">2</span></span>|<span data-ttu-id="35846-155">Números de versión principales y secundarios de tolerancia a errores de FileX.</span><span class="sxs-lookup"><span data-stu-id="35846-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="35846-156">Reservado</span><span class="sxs-lookup"><span data-stu-id="35846-156">Reserved</span></span>|<span data-ttu-id="35846-157">2</span><span class="sxs-lookup"><span data-stu-id="35846-157">2</span></span>|<span data-ttu-id="35846-158">Para una futura expansión.</span><span class="sxs-lookup"><span data-stu-id="35846-158">For future expansion.</span></span>|

<span data-ttu-id="35846-159">El área de encabezado del registro va seguida del área del registro de la cadena FAT.</span><span class="sxs-lookup"><span data-stu-id="35846-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="35846-160">La figura 9 contiene información que describe cómo se debe modificar la cadena FAT.</span><span class="sxs-lookup"><span data-stu-id="35846-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="35846-161">Esta área del registro contiene información sobre los clústeres que se van a asignar a un archivo, los clústeres que se van a quitar de un archivo y dónde debe estar la inserción/eliminación y describe cada campo del área del registro de la cadena FAT.</span><span class="sxs-lookup"><span data-stu-id="35846-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="35846-162">**TABLA 9. Área del registro de la cadena FAT**</span><span class="sxs-lookup"><span data-stu-id="35846-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="35846-163">Campo</span><span class="sxs-lookup"><span data-stu-id="35846-163">Field</span></span>|<span data-ttu-id="35846-164">Tamaño (en bytes)</span><span class="sxs-lookup"><span data-stu-id="35846-164">Size(in bytes)</span></span>|<span data-ttu-id="35846-165">Descripción</span><span class="sxs-lookup"><span data-stu-id="35846-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="35846-166">Suma de comprobación del registro de la cadena FAT</span><span class="sxs-lookup"><span data-stu-id="35846-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="35846-167">2</span><span class="sxs-lookup"><span data-stu-id="35846-167">2</span></span>|<span data-ttu-id="35846-168">Suma de comprobación del área del registro de la cadena FAT completa.</span><span class="sxs-lookup"><span data-stu-id="35846-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="35846-169">El área del registro de la cadena FAT no se considera válida si se produce un error en la comprobación de la suma de comprobación.</span><span class="sxs-lookup"><span data-stu-id="35846-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="35846-170">Marcar</span><span class="sxs-lookup"><span data-stu-id="35846-170">Flag</span></span>|<span data-ttu-id="35846-171">1</span><span class="sxs-lookup"><span data-stu-id="35846-171">1</span></span>|<span data-ttu-id="35846-172">Los valores de marca válidos son:</span><span class="sxs-lookup"><span data-stu-id="35846-172">Valid flag values are:</span></span><br/><span data-ttu-id="35846-173">0x01 cadena FAT válida</span><span class="sxs-lookup"><span data-stu-id="35846-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="35846-174">0x02 se está utilizando el mapa de bits</span><span class="sxs-lookup"><span data-stu-id="35846-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="35846-175">Reservado</span><span class="sxs-lookup"><span data-stu-id="35846-175">Reserved</span></span>|<span data-ttu-id="35846-176">1</span><span class="sxs-lookup"><span data-stu-id="35846-176">1</span></span>|<span data-ttu-id="35846-177">Reservado para uso futuro</span><span class="sxs-lookup"><span data-stu-id="35846-177">Reserved for future use</span></span>|
|<span data-ttu-id="35846-178">Punto de inserción: Frontal</span><span class="sxs-lookup"><span data-stu-id="35846-178">Insertion Point – Front</span></span>|<span data-ttu-id="35846-179">4</span><span class="sxs-lookup"><span data-stu-id="35846-179">4</span></span>|<span data-ttu-id="35846-180">El clúster (que pertenece a la cadena FAT original) a la que se va a adjuntar la cadena recién creada.</span><span class="sxs-lookup"><span data-stu-id="35846-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="35846-181">Clúster principal de la nueva cadena FAT</span><span class="sxs-lookup"><span data-stu-id="35846-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="35846-182">4</span><span class="sxs-lookup"><span data-stu-id="35846-182">4</span></span>|<span data-ttu-id="35846-183">Primer clúster de la cadena FAT recién creada</span><span class="sxs-lookup"><span data-stu-id="35846-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="35846-184">Clúster principal de la cadena FAT original</span><span class="sxs-lookup"><span data-stu-id="35846-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="35846-185">4</span><span class="sxs-lookup"><span data-stu-id="35846-185">4</span></span>|<span data-ttu-id="35846-186">Primer clúster de la parte de la cadena FAT original que se va a quitar.</span><span class="sxs-lookup"><span data-stu-id="35846-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="35846-187">Punto de inserción: Trasero</span><span class="sxs-lookup"><span data-stu-id="35846-187">Insertion Point – Back</span></span>|<span data-ttu-id="35846-188">4</span><span class="sxs-lookup"><span data-stu-id="35846-188">4</span></span>|<span data-ttu-id="35846-189">El clúster original en el que se combina la cadena FAT recién creada.</span><span class="sxs-lookup"><span data-stu-id="35846-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="35846-190">Siguiente punto de eliminación</span><span class="sxs-lookup"><span data-stu-id="35846-190">Next Deletion Point</span></span>|<span data-ttu-id="35846-191">4</span><span class="sxs-lookup"><span data-stu-id="35846-191">4</span></span>|<span data-ttu-id="35846-192">Este campo ayuda al procedimiento de limpieza de la cadena FAT.</span><span class="sxs-lookup"><span data-stu-id="35846-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="35846-193">El área de las entradas de registro contiene entradas de registro que describen los cambios necesarios para recuperarse de un error.</span><span class="sxs-lookup"><span data-stu-id="35846-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="35846-194">Se admiten tres tipos de entradas de registro en el módulo de tolerancia a errores de FileX: entrada de registro FAT; entrada de registro de directorio; y entrada de registro de mapa de bits.</span><span class="sxs-lookup"><span data-stu-id="35846-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="35846-195">En las tres figuras y tres tablas siguientes se describen detalladamente estas entradas de registro.</span><span class="sxs-lookup"><span data-stu-id="35846-195">The following three figures and three tables describe these log entries in detail.</span></span>

![Entrada de registro FAT](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="35846-197">**Figura 6. Entrada de registro FAT**</span><span class="sxs-lookup"><span data-stu-id="35846-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="35846-198">**TABLA 10. Entrada de registro FAT**</span><span class="sxs-lookup"><span data-stu-id="35846-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="35846-199">Campo</span><span class="sxs-lookup"><span data-stu-id="35846-199">Field</span></span>|<span data-ttu-id="35846-200">Tamaño (en bytes)</span><span class="sxs-lookup"><span data-stu-id="35846-200">Size(in bytes)</span></span>|<span data-ttu-id="35846-201">Descripción</span><span class="sxs-lookup"><span data-stu-id="35846-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="35846-202">Tipo</span><span class="sxs-lookup"><span data-stu-id="35846-202">Type</span></span>|<span data-ttu-id="35846-203">2</span><span class="sxs-lookup"><span data-stu-id="35846-203">2</span></span>|<span data-ttu-id="35846-204">Tipo de entrada, debe ser FX_FAULT_TOLERANT_FAT_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="35846-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="35846-205">Size</span><span class="sxs-lookup"><span data-stu-id="35846-205">Size</span></span>|<span data-ttu-id="35846-206">2</span><span class="sxs-lookup"><span data-stu-id="35846-206">2</span></span>|<span data-ttu-id="35846-207">Tamaño de esta entrada</span><span class="sxs-lookup"><span data-stu-id="35846-207">Size of this entry</span></span>|
|<span data-ttu-id="35846-208">Número de clúster</span><span class="sxs-lookup"><span data-stu-id="35846-208">Cluster Number</span></span>|<span data-ttu-id="35846-209">4</span><span class="sxs-lookup"><span data-stu-id="35846-209">4</span></span>|<span data-ttu-id="35846-210">Número de clúster</span><span class="sxs-lookup"><span data-stu-id="35846-210">Cluster number</span></span>|
|<span data-ttu-id="35846-211">Value</span><span class="sxs-lookup"><span data-stu-id="35846-211">Value</span></span>|<span data-ttu-id="35846-212">4</span><span class="sxs-lookup"><span data-stu-id="35846-212">4</span></span>|<span data-ttu-id="35846-213">Valor que se va a escribir en la entrada FAT</span><span class="sxs-lookup"><span data-stu-id="35846-213">Value to be written into the FAT entry</span></span>|

![Entrada de registro de directorio](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="35846-215">**Figura 7. Entrada de registro de directorio**</span><span class="sxs-lookup"><span data-stu-id="35846-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="35846-216">**TABLA 11. Entrada de registro de directorio**</span><span class="sxs-lookup"><span data-stu-id="35846-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="35846-217">Campo</span><span class="sxs-lookup"><span data-stu-id="35846-217">Field</span></span>|<span data-ttu-id="35846-218">Tamaño (en bytes)</span><span class="sxs-lookup"><span data-stu-id="35846-218">Size(in bytes)</span></span>|<span data-ttu-id="35846-219">Descripción</span><span class="sxs-lookup"><span data-stu-id="35846-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="35846-220">Tipo</span><span class="sxs-lookup"><span data-stu-id="35846-220">Type</span></span>|<span data-ttu-id="35846-221">2</span><span class="sxs-lookup"><span data-stu-id="35846-221">2</span></span>|<span data-ttu-id="35846-222">Tipo de entrada, debe ser FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="35846-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="35846-223">Size</span><span class="sxs-lookup"><span data-stu-id="35846-223">Size</span></span>|<span data-ttu-id="35846-224">2</span><span class="sxs-lookup"><span data-stu-id="35846-224">2</span></span>|<span data-ttu-id="35846-225">Tamaño de esta entrada</span><span class="sxs-lookup"><span data-stu-id="35846-225">Size of this entry</span></span>|
|<span data-ttu-id="35846-226">Desplazamiento de sectores</span><span class="sxs-lookup"><span data-stu-id="35846-226">Sector Offset</span></span>|<span data-ttu-id="35846-227">4</span><span class="sxs-lookup"><span data-stu-id="35846-227">4</span></span>|<span data-ttu-id="35846-228">Desplazamiento (en bytes) en el sector donde se encuentra este directorio.</span><span class="sxs-lookup"><span data-stu-id="35846-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="35846-229">Sector de registro</span><span class="sxs-lookup"><span data-stu-id="35846-229">Log Sector</span></span>|<span data-ttu-id="35846-230">4</span><span class="sxs-lookup"><span data-stu-id="35846-230">4</span></span>|<span data-ttu-id="35846-231">Sector en el que se encuentra la entrada de directorio</span><span class="sxs-lookup"><span data-stu-id="35846-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="35846-232">Datos de registro</span><span class="sxs-lookup"><span data-stu-id="35846-232">Log Data</span></span>|<span data-ttu-id="35846-233">Variable</span><span class="sxs-lookup"><span data-stu-id="35846-233">Variable</span></span>|<span data-ttu-id="35846-234">Contenido de la entrada de directorio</span><span class="sxs-lookup"><span data-stu-id="35846-234">Content of the directory entry</span></span>|

![Entrada de registro de mapa de bits](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="35846-236">**Figura 8. Entrada de registro de mapa de bits**</span><span class="sxs-lookup"><span data-stu-id="35846-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="35846-237">**TABLA 12. Entrada de registro de mapa de bits**</span><span class="sxs-lookup"><span data-stu-id="35846-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="35846-238">Campo</span><span class="sxs-lookup"><span data-stu-id="35846-238">Field</span></span>|<span data-ttu-id="35846-239">Tamaño (en bytes)</span><span class="sxs-lookup"><span data-stu-id="35846-239">Size(in bytes)</span></span>|<span data-ttu-id="35846-240">Descripción</span><span class="sxs-lookup"><span data-stu-id="35846-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="35846-241">Tipo</span><span class="sxs-lookup"><span data-stu-id="35846-241">Type</span></span>|<span data-ttu-id="35846-242">2</span><span class="sxs-lookup"><span data-stu-id="35846-242">2</span></span>|<span data-ttu-id="35846-243">Tipo de entrada, debe ser FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="35846-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="35846-244">Size</span><span class="sxs-lookup"><span data-stu-id="35846-244">Size</span></span>|<span data-ttu-id="35846-245">2</span><span class="sxs-lookup"><span data-stu-id="35846-245">2</span></span>|<span data-ttu-id="35846-246">Tamaño de esta entrada</span><span class="sxs-lookup"><span data-stu-id="35846-246">Size of this entry</span></span>|
|<span data-ttu-id="35846-247">Número de clúster</span><span class="sxs-lookup"><span data-stu-id="35846-247">Cluster Number</span></span>|<span data-ttu-id="35846-248">4</span><span class="sxs-lookup"><span data-stu-id="35846-248">4</span></span>|<span data-ttu-id="35846-249">Número de clúster</span><span class="sxs-lookup"><span data-stu-id="35846-249">Cluster number</span></span>|
|<span data-ttu-id="35846-250">Value</span><span class="sxs-lookup"><span data-stu-id="35846-250">Value</span></span>|<span data-ttu-id="35846-251">4</span><span class="sxs-lookup"><span data-stu-id="35846-251">4</span></span>|<span data-ttu-id="35846-252">Valor que se va a escribir en la entrada FAT</span><span class="sxs-lookup"><span data-stu-id="35846-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="35846-253">Protección de tolerancia a errores</span><span class="sxs-lookup"><span data-stu-id="35846-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="35846-254">Una vez que se inicia el módulo de tolerancia a errores de FileX, este busca primero un archivo de registro de tolerancia a errores existente en el soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="35846-255">Si no se encuentra un archivo de registro válido, FileX considera que el soporte físico no está protegido.</span><span class="sxs-lookup"><span data-stu-id="35846-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="35846-256">En este caso, FileX creará un archivo de registro de tolerancia a errores en el soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="35846-257">\*FileX no puede proteger un sistema de archivos si estaba dañado antes de que se inicie el módulo de tolerancia a errores de FileX.</span><span class="sxs-lookup"><span data-stu-id="35846-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="35846-258">Si se encuentra un archivo de registro de tolerancia a errores, FileX comprueba las entradas de registro existentes.</span><span class="sxs-lookup"><span data-stu-id="35846-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="35846-259">Un archivo de registro sin entradas de registro indica que la operación de archivo anterior se realizó correctamente y se quitaron todas las entradas de registro.</span><span class="sxs-lookup"><span data-stu-id="35846-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="35846-260">En este caso, la aplicación puede empezar a usar el sistema de archivos con protección de tolerancia a errores.</span><span class="sxs-lookup"><span data-stu-id="35846-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="35846-261">Sin embargo, si se encuentran entradas de registro, FileX debe completar la operación de archivo anterior o revertir los cambios ya aplicados al sistema de archivos, deshacer los cambios de forma efectiva.</span><span class="sxs-lookup"><span data-stu-id="35846-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="35846-262">En cualquier caso, después de que se apliquen las entradas de registro en el sistema de archivos, el sistema de archivos se restaura en un estado coherente y la aplicación puede empezar a usar el sistema de archivos de nuevo.</span><span class="sxs-lookup"><span data-stu-id="35846-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="35846-263">En el caso de los soportes físicos protegidos por FileX, durante la operación de actualización de archivos, la parte de datos se escribe directamente en el soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="35846-264">A medida que FileX escribe datos, también registra los cambios necesarios que se deben aplicar a las entradas de directorio, tabla FAT.</span><span class="sxs-lookup"><span data-stu-id="35846-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="35846-265">Esta información se registra en las entradas de registro con tolerancia a archivos.</span><span class="sxs-lookup"><span data-stu-id="35846-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="35846-266">Este enfoque garantiza que las actualizaciones del sistema de archivos se producen después de que los datos se escriban en el soporte físico.</span><span class="sxs-lookup"><span data-stu-id="35846-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="35846-267">Si el soporte físico se expulsa durante la fase de escritura de datos, todavía no se ha cambiado la información crucial del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="35846-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="35846-268">Por lo tanto, el sistema de archivos no se ve afectado por la interrupción.</span><span class="sxs-lookup"><span data-stu-id="35846-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="35846-269">Una vez que todos los datos se han escrito correctamente en el soporte físico, FileX sigue la información de las entradas de registro para aplicar los cambios a la información del sistema, una entrada por una.</span><span class="sxs-lookup"><span data-stu-id="35846-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="35846-270">Una vez confirmada toda la información del sistema en el soporte físico, las entradas de registro se quitan del registro de tolerancia a errores.</span><span class="sxs-lookup"><span data-stu-id="35846-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="35846-271">En este momento, FileX completa la operación de actualización del archivo.</span><span class="sxs-lookup"><span data-stu-id="35846-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="35846-272">Durante la operación de actualización de archivos, los archivos no se actualizan en su lugar.</span><span class="sxs-lookup"><span data-stu-id="35846-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="35846-273">El módulo de tolerancia a errores asigna un sector para los datos en los que se van a escribir los nuevos datos y, a continuación, quita el sector que contiene los datos que se van a sobrescribir, actualizando las entradas FAT relacionadas para vincular el nuevo sector a la cadena.</span><span class="sxs-lookup"><span data-stu-id="35846-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="35846-274">En situaciones en las que es necesario modificar los datos parciales de un clúster, FileX siempre asigna nuevos clústeres, escribe todos los datos de los clústeres antiguos con datos actualizados en los nuevos clústeres y, a continuación, libera los clústeres antiguos.</span><span class="sxs-lookup"><span data-stu-id="35846-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="35846-275">Esto garantiza que si se interrumpe la actualización del archivo, el archivo original permanece intacto.</span><span class="sxs-lookup"><span data-stu-id="35846-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="35846-276">La aplicación debe tener en cuenta que en la protección de tolerancia a errores de FileX, la actualización de los datos en un archivo requiere que el soporte físico tenga suficiente espacio libre para almacenar datos nuevos antes de que se puedan liberar los sectores con datos antiguos.</span><span class="sxs-lookup"><span data-stu-id="35846-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="35846-277">Si el soporte físico no tiene suficiente espacio para almacenar datos nuevos, se produce un error en la operación de actualización.</span><span class="sxs-lookup"><span data-stu-id="35846-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
