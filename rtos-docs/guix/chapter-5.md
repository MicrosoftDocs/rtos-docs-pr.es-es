---
title: 'Capítulo 5: Controladores de pantalla de GUIX'
description: Los controladores de pantalla de GUIX definen la interfaz de software entre el lienzo de dibujo abstracto y el hardware de pantalla físico.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 7c8f509aee1892693c22f8cfba3207158de4a1e9
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/22/2021
ms.locfileid: "104815502"
---
# <a name="chapter-5---guix-display-drivers"></a>Capítulo 5: Controladores de pantalla de GUIX

Los controladores de pantalla de GUIX definen la interfaz de software entre el lienzo de dibujo abstracto y el hardware de pantalla físico. El controlador de pantalla de GUIX implementa las funciones de dibujo de nivel más bajo que realmente cambian la información de color de píxeles en la memoria del lienzo y transfieren la memoria del lienzo al búfer de fotogramas de la pantalla física en sistemas con doble búfer.

Los controladores de pantalla GUIX se definen mediante una estructura que contiene los parámetros de presentación físicos y un conjunto de punteros de función a las funciones de controlador de bajo nivel. Mediante el uso de estos punteros de función indirectos, las funciones de dibujo abstractas lienzo y widget se realizan de forma completamente independiente de los detalles de hardware.

GUIX proporciona un conjunto predeterminado completo y totalmente funcional de funciones de dibujo para cada formato de color y profundidad de color admitido. Al implementar un controlador de pantalla sin ninguna funcionalidad de aceleración de hardware específica u otras consideraciones específicas del hardware, estas funciones de dibujo predeterminadas son normalmente suficientes para la implementación final del controlador. Para estos controladores más sencillos, la única función que normalmente debe implementarse en el software de controlador es una función para configurar el dispositivo de hardware. Esto suele implicar la inicialización de varios registros de hardware para definir el reloj de pantalla LCD, las dimensiones de visualización, etc. Para todas las demás funciones, la implementación del controlador simplemente inicializa los punteros de función GX_DISPLAY a las implementaciones de funciones predeterminadas para la profundidad de color y el formato deseados.

Al implementar un controlador de pantalla personalizado, el procedimiento recomendado es inicializar primero los punteros de función de dibujo del controlador de pantalla con la implementación de software predeterminada para la profundidad de color que desea admitir y, a continuación, reemplazar esos punteros de función cuando desee para llamar a las implementaciones de funciones personalizadas (si existen). Para ayudarlo, hay una función de instalación predeterminada disponible para cada formato y profundidad de color admitidos. Por ejemplo, si está escribiendo un controlador de pantalla RGB con formato de 16 bits 5:6:5, lo primero que el controlador personalizado haría normalmente es invocar la rutina de configuración genérica para esta profundidad de color:

UINT my_custom_565_display_driver(GX_DISPLAY *display)

```c
{
      
      // perform standard function pointer setup
      
      _gx_display_driver_565rgb_setup(display, GX_NULL,
      
             my_buffertoggle);

}
```

El parámetro my_buffer_toggle anterior es un puntero a la función de alternancia de búfer del controlador de pantalla (que puede estar GX_NULL si el controlador tiene un solo búfer y se dibuja directamente en el búfer de fotogramas de hardware).

Si está escribiendo un controlador de pantalla personalizado, tendrá que incluir el archivo de encabezado gx_display.h en el origen del controlador personalizado, que es un archivo de encabezado de uso interno que no está disponible para el software de nivel de aplicación.

Las funciones de dibujo de nivel de presentación de GUIX reciben como entrada un puntero a una estructura de **GX_DRAW_CONTEXT**. La estructura **GX_DRAW_CONTEXT** define las coordenadas de recorte para la operación de dibujo actual junto con el pincel y los colores que se usan. Cada función de dibujo recibe como parámetros adicionales de entrada específicos de los requisitos de función.

La firma del punto de entrada del controlador **GX_DISPLAY** se define como

```c
UINT <device>_graphics_driver_<format>(GX_DISPLAY *diplay)
```

Aunque el nombre de esta función es completamente el implementador, la convención de los controladores proporcionados con GUIX es usar un nombre de dispositivo específico de hardware en el campo <device> y el formato de color para el campo anterior <format>.

Esta función debe inicializar la estructura de **GX_DISPLAY** proporcionada como entrada y realizar la instalación de hardware necesaria. La estructura **GX_DISPLAY** contiene los campos siguientes.

| &nbsp; |
| --- | --- |
| ULONG gx_display_id <br/> Se trata de un campo para su uso por parte de la aplicación, en los casos en que se crea más de una instancia de un controlador determinado. |
| CHAR *gx_display_name <br/> Nombre opcional que se usa para identificar el controlador. |
| GX_DISPLAY *gx_display_created_next <br/> GUIX inicializa este campo y se usa para crear y mantener una lista de todas las instancias de GX_DISPLAY. |
| GX_DISPLAY *gx_display_created_previous <br/> GUIX inicializa este campo y se usa para crear y mantener una lista de todas las instancias de GX_DISPLAY. |
| GX_VALUE gx_display_color_format <br/> Este campo debe reflejar el formato de datos de gráficos compatible con este controlador. Los tipos de formato de color se definen en el archivo de encabezado gx_api.h. |
| GX_VALUE gx_display_width <br/> Este campo debe inicializarse para que contenga el ancho físico de la pantalla, en píxeles. |
| GX_VALUE gx_display_height <br/> Este campo se debe inicializar para que contenga el alto de la pantalla física, en píxeles. |
| GX_COLOR *gx_display_color_table <br/> Es un puntero a una tabla que se usa para convertir valores de identificador de color en valores de color específicos de formato de color. |
| GX_PIXELMAP *gx_display_pixelmap_table <br/> Se trata de un puntero a la tabla PixelMap activa para esta pantalla. |
| GX_FONT *gx_display_font_table <br/> Este es un puntero a la tabla de fuentes activa para esta pantalla. |
| GX_COLOR *gx_display_palette <br/> En el caso de los controladores de modo de paleta, se trata de un puntero a la paleta de colores activa. En el caso de los controladores que no usan una paleta de colores, este puntero es GX_NULL. |
| UINT gx_display_pixelmap_table_size <br/> Número de entradas en la tabla PixelMap activa. |
| UINT gx_display_font_table_size <br/> Número de entradas de la tabla de fuentes activas. |
| UINT gx_display_palette_size <br/> Número de entradas en la paleta de colores (si existen). |
| ULONG gx_display_handle <br/> Identificador único, o *manipulador*, que especifica la presentación.
| UINT gx_display_driver_ready <br/> Este campo se usa para indicar a GUIX cuando el controlador está listo para su operación. En algunos casos, es posible que el controlador requiera varios niveles de inicialización y configuración, en cuyo tiempo GUIX no debe intentar usar el controlador. Esta marca debe establecerse en 1 cuando el controlador esté listo para atender las solicitudes de dibujo. |
| VOID * gx_display_driver_data <br/> Este campo es para su uso por parte de la implementación del controlador. Si el controlador necesita crear y hacer referencia a información adicional no disponible en la estructura de GX_DISPLAY, el controlador debe asignar espacio para y apuntar a estos datos adicionales mediante este campo de estructura. Un ejemplo de datos adicionales específicos del controlador podría incluir el canal DMA que está usando el controlador o el canal SPI al que está conectado el búfer de fotograma de la pantalla. |
| VOID (*gx_display_driver_drawing_initiate)(struct GX_DISPLAY_STRUCT *display, struct GX_CANVAS_STRUCT *canvas) <br/> Se trata de un puntero de función que, si no es NULL, se invoca mediante la función gx_canvas_drawing_initiate. En el caso de los controladores de pantalla que usan un acelerador de gráficos o una lista de visualización de gráficos de hardware, esta función se puede usar para iniciar una nueva lista de visualización. Este puntero de función puede ser NULL. |
| VOID (*gx_display_driver_palette_set)(struct GX_DISPLAY_STRUCT *display, GX_COLOR *palette, INT count) <br/> Se trata de un puntero a una función para instalar una paleta de colores. Esta función es NULL a menos que el controlador funcione en el modo de paleta (también denominado tabla de búsqueda de color o CLUT). |
| VOID (*gx_display_driver_simple_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Se trata de un puntero a una función para implementar dibujos de líneas genéricos, sin suavizado de contorno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_simple_wide_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Se trata de un puntero a una función para implementar un dibujo de línea ancha genérico, sin suavizado de contorno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Se trata de un puntero a una función para implementar un dibujo de líneas con suavizado de contorno genérico. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_wide_line_draw)(GX_DRAW_CONTECT *context, INT x1, INTy1, INT x2, INT y2) <br/> Se trata de un puntero a una función para implementar un dibujo de líneas anchas con suavizado de contorno genérico. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_horizonal_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y) <br/> Se trata de un puntero a una función para implementar el caso especial de dibujo de línea horizontal. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_horizonal_pixelmap_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y, GX_PIXELMAP *map) <br/> Se trata de un puntero a una función para implementar el dibujo de una sola fila de PixelMap. Esta función se usa internamente para formas de relleno de patrones. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_vertical_line_draw)(GX_DRAW_CONTECT *context, INT y1, INT y2, INT x) <br/> Se trata de un puntero a una función para implementar el caso especial de dibujo de línea horizontal. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_horizonal_pattern_line_draw)(GX_DRAW_CONTECT *context, INT x1, INT x2, INT y) <br/> Es un puntero a una función para implementar el dibujo de línea de patrón horizontal. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_vertical_pattern_line_draw)(GX_DRAW_CONTECT *context, INT y1, INT y2, INT x) <br/> Es un puntero a una función para implementar el dibujo de línea de patrón vertical. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_canvas_copy)(struct GX_CANVAS_STRUCT *source, struct GX_CANVAS_STRUCT *dest) <br/> Se trata de un puntero a una función para copiar datos de lienzo de un lienzo a otro. El rectángulo no válido del lienzo de origen se utiliza para definir el área de copia. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_canvas_blend)(struct GX_CANVAS_STRUCT *source, struct GX_CANVAS_STRUCT *dest) <br/> Se trata de un puntero a una función para los datos del lienzo de mezcla alfa desde el lienzo de origen con los datos existentes en el lienzo de destino. El rectángulo no válido del lienzo de origen se usa para definir el área de mezcla. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_pixelmap_blend)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp, GX_UBYTE alpha) <br/> Se trata de un puntero a una función para combinar un PixelMap en el lienzo de fondo definido por el contexto de dibujo. El valor alfa proporcionado puede ser además de un canal alfa incluido en los datos de PixelMap. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_pixelmap_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Se trata de un puntero a una función para dibujar un PixelMap en el lienzo definido por el contexto de dibujo. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_jpeg_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Se trata de un puntero a una función para descodificar una imagen jpg y representarla directamente en el lienzo. Esta función solo se proporciona si se define GX_SOFTWARE_DECODER_SUPPORT. Este puntero de función tiene un valor NULL. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_png_draw)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp) <br/> Se trata de un puntero a una función para descodificar una imagen png y representarla directamente en el lienzo. Esta función solo se proporciona si se define GX_SOFTWARE_DECODER_SUPPORT. Este puntero de función tiene un valor NULL. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_pixelmap_rotate)(GX_DRAW_CONTEXT *context, INT xpos, INT ypos, GX_PIXELMAP *pmp INT angle, INT rot_cx, INT rot_cy) <br/> Se trata de un puntero a una función para rotar un PixelMap y representar el resultado directamente en el lienzo. Esta función se invoca mediante el gx_canvas_pixelmap_rotate las implementaciones de APIDefault de esta función se proporcionan para cada formato de color y profundidad de color admitidos. |
| VOID *gx_display_driver_pixel_write)(GX_DRAW_CONTEXT *context, INT x, INT y, GX_COLOR color) <br/> Se trata de un puntero a una función para escribir un píxel en la memoria del lienzo. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. <br/>
| VOID *gx_display_driver_block_move)(GX_DRAW_CONTEXT *context,GX_RECTANGLE *block, INT xshift, INT yshift) <br/> Se trata de un puntero a una función para mover o desplazar un bloque de píxeles dentro de un lienzo. Esta función se usa principalmente para desplazarse rápidamente por el contenido de una ventana. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_pixel_blend)(GX_DRAW_CONTEXT *context, INT x, INT y, GX_COLOR color, GX_UBYTE alpha) <br/> Esta función se usa para fusionar mediante mezcla alfa el valor de color de píxel entrante con el valor de color existente en la memoria del lienzo en la posición x, y. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| GX_COLOR (*gx_display_driver_native_color_get)(GX_COLOR rawcolor) <br/> Esta función convierte un color del formato de color A:R:G:B de 32 bits usado internamente por GUIX en el formato de color nativo del lienzo y se muestra. Se espera cierta pérdida de información de color para los controladores de pantalla que se ejecutan con profundidades de color inferiores. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| USHORT (*gx_display_driver_row_pitch_get)(USHORT width) <br/> Devuelve el recuento de bytes o el paso de una fila de datos de gráficos según el ancho de lienzo solicitado. Esta función se usa para calcular el tamaño del área de memoria necesaria para crear un lienzo. El extremo y el ancho de la fila no son siempre los mismos debido a las restricciones de alineación de la línea de análisis de hardware. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_buffer_toggle)(struct GX_CANVAS_STRUCT *canvas, GX_RECTANGLE *dirty_area) <br/> Se trata de un puntero a una función para alternar entre los búferes de fotogramas de trabajo y visibles para los sistemas de memoria de búfer doble. Esta función debe indicar primero al hardware que empiece a usar el nuevo búfer de fotogramas y, después, copiar la parte modificada del nuevo búfer visible en el búfer complementario para asegurarse de que los dos búferes permanecen sincronizados. | 
| VOID (*gx_display_driver_polygon_draw)(GX_DRAW_CONTEXT *context, INT num_points, GX_POINT *vertices <br/> Puntero a una función para dibujar un polígono. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_polygon_fill)(GX_DRAW_CONTEXT *context, INT num_points, GX_POINT *vertices <br/> Puntero a una función para dibujar un polígono relleno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_circle_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Puntero a una función para dibujar un círculo. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_circle_draw) (GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Puntero a una función para dibujar un círculo suavizado. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_wide_circle_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Puntero a una función para dibujar un círculo con un contorno ancho. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_wide_anti_aliased_circle_draw) (GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Puntero a una función para dibujar un círculo suavizado con un contorno ancho. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_circle_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r) <br/> Puntero a una función para dibujar un círculo relleno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Puntero a una función para dibujar un arco. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INTend_angle) <br/> Puntero a una función para dibujar un arco suavizado. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_wide_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Puntero a una función para dibujar un arco con un contorno ancho. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_wide_arc_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INTend_angle) <br/> Puntero a una función para dibujar un arco suavizado. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_arc_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Puntero a una función para dibujar un arco relleno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_pie_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, UINT r, INT start_angle, INT end_angle) <br/> Puntero a una función para dibujar un círculo relleno. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Puntero a una función para dibujar una elipse. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Puntero a una función para dibujar una elipse. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_wide_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Puntero a una función para dibujar una elipse con un contorno ancho. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_anti_aliased_wide_ellipse_draw)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Puntero a una función para dibujar una elipse con un contorno ancho. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_ellipse_fill)(GX_DRAW_CONTEXT *context, INT xcenter, INT ycenter, INT a, INT b) <br/> Puntero a una función para dibujar una elipse rellena. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_8bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, constGX_GLYPH *glyph) <br/> Puntero a la función para dibujar un glifo de texto con alias de 8 bits en el lienzo mediante el pincel del contexto del dibujo actual. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_4bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, const GX_GLYPH *glyph) <br/> Puntero a la función para dibujar un glifo de texto con alias de 4 bits en el lienzo mediante el pincel del contexto del dibujo actual. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |
| VOID (*gx_display_driver_1bit_glyph_draw)(GX_DRAW_CONTEXT *context, GX_RECTANGLE *draw_area, GX_POINT *map_offset, const GX_GLYPH *glyph) <br/> Puntero a la función para dibujar el glifo de texto monocromo de 1 bit en el lienzo mediante el pincel del contexto del dibujo actual. Se proporcionan implementaciones predeterminadas de esta función para cada formato de color y profundidad de color admitido. |


